import sys, os
UP_DIR=os.path.abspath(os.path.join(
		os.path.dirname(__file__),
		"..",".."
	)
)
sys.path.append(UP_DIR)

from plsp import Logger
from plsp import infoinject



plsp = Logger()

plsp.add_debug_context("generic")
plsp.add_debug_mode("info")

plsp.debug_contexts["generic"].set_is_active(True)
plsp.debug_contexts["generic"].add_direction(
	do_encode=False,
	file_handle=sys.stdout.fileno(),
	file_path=None
)

plsp.set_debug_mode("info")



infoinject.set_name_of_logger("plsp")
infoinject.set_do_print_generated(True)



exploit = "print(\"We exploited the `exec` function!\")"

@infoinject.add_instruction("foo1", 1, "info", "generic", args_for_logger=(
	f"\", {exploit}, f\"bar: [{infoinject.Var_Ref('bar')}]",
))
@infoinject.inject("foo1", globals(), locals())
def foo1(bar):
	print(bar)


@infoinject.add_instruction("foo2", 1, "info", "generic", args_for_logger=(
	f"{{'' if {exploit} is None else ''}}\", f\"bar: [{infoinject.Var_Ref('bar')}]",
))
@infoinject.inject("foo2", globals(), locals())
def foo2(bar):
	print(bar)

foo1("Hello, World!")
foo2("Hello, World!")
